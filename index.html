<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exhibit Canvas</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Cropper.js CDN 추가 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.6.2/dist/cropper.min.css">
    <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.6.2/dist/cropper.min.js"></script>
</head>
<body>
    <div class="container">
        <div id="initial-screen" class="initial-screen">
            <h2>Exhibit Canvas 시작하기</h2>
            <button class="button button-primary" onclick="startNewProject()">프로젝트 생성하기</button>
            <button class="button button-secondary" onclick="loadExistingProject()">프로젝트 불러오기</button>
        </div>

        <div class="header">
            <h1>🖼️ Exhibit Canvas</h1>
            <div class="subtitle">전시할 가벽을 생성하고 액자를 배치한 후, 평면도에서 전시 공간을 설계하세요</div>
        </div>

        <!-- 탭 네비게이션 -->
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('wall-editor')">🖼️ 벽 관리</button>
            <button class="tab-button" onclick="switchTab('floor-plan')">📐 평면도</button>
        </div>

        <!-- 벽 관리 탭 -->
        <div id="wall-editor" class="tab-content active">
            <div class="main-content">
                <div class="controls">
                    <div class="control-section">
                        <h3>벽 선택</h3>
                        <select id="wallSelect" onchange="switchWall()">
                            <option value="">가벽 생성</option>
                        </select>
                        <input type="text" id="wallName" placeholder="벽 이름 (예: A벽, 정면벽)" maxlength="20">
                        <button class="button button-primary" onclick="createOrUpdateWall()">벽 저장</button>
                        <button class="button button-danger" onclick="deleteCurrentWall()">현재 벽 삭제</button>
                    </div>

                    <div class="control-section">
                        <h3>벽 크기</h3>
                        <div class="control-group">
                            <label>벽 너비 (cm)</label>
                            <input type="number" id="wallWidth" value="400" min="100" max="10000" step="1">
                        </div>
                        <div class="control-group">
                            <label>벽 높이 (cm)</label>
                            <input type="number" id="wallHeight" value="300" min="100" max="5000" step="1">
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>액자 추가</h3>
                        <div class="control-group">
                            <label>액자 이름</label>
                            <input type="text" id="frameName" placeholder="예: 작품1, 서울전경" maxlength="30">
                        </div>
                        <div class="control-group">
                            <label>액자 너비 (cm)</label>
                            <input type="number" id="frameWidth" value="60" min="10" max="500" step="1">
                        </div>
                        <div class="control-group">
                            <label>액자 높이 (cm)</label>
                            <input type="number" id="frameHeight" value="80" min="10" max="500" step="1">
                        </div>
                        <button class="button button-primary" onclick="addFrame()">액자 추가</button>
                        <button class="button button-secondary" onclick="clearAllFrames()">액자 전체 삭제</button>
                    </div>

                    <div class="control-section">
                        <h3>🎯 액자 정렬 및 분배</h3>
                        <div class="info-item" style="margin-bottom: 10px; font-size: 12px; color: #3498db;">
                            💡 Ctrl+클릭으로 여러 액자 선택
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px;">
                            <button class="button" style="background: #9b59b6; color: white; padding: 8px; font-size: 12px;" onclick="alignFrames('top')">
                                ⬆️ 상단
                            </button>
                            <button class="button" style="background: #9b59b6; color: white; padding: 8px; font-size: 12px;" onclick="alignFrames('bottom')">
                                ⬇️ 하단
                            </button>
                            <button class="button" style="background: #9b59b6; color: white; padding: 8px; font-size: 12px;" onclick="alignFrames('left')">
                                ⬅️ 좌측
                            </button>
                            <button class="button" style="background: #9b59b6; color: white; padding: 8px; font-size: 12px;" onclick="alignFrames('right')">
                                ➡️ 우측
                            </button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px;">
                            <button class="button" style="background: #8e44ad; color: white; padding: 8px; font-size: 12px;" onclick="alignFrames('centerX')">
                                🎯 중앙(가로)
                            </button>
                            <button class="button" style="background: #8e44ad; color: white; padding: 8px; font-size: 12px;" onclick="alignFrames('centerY')">
                                🎯 중앙(세로)
                            </button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                            <button class="button" style="background: #16a085; color: white; padding: 8px; font-size: 12px;" onclick="alignFrames('distributeX')">
                                ↔️ 가로 분배
                            </button>
                            <button class="button" style="background: #16a085; color: white; padding: 8px; font-size: 12px;" onclick="alignFrames('distributeY')">
                                ↕️ 세로 분배
                            </button>
                        </div>
                    </div>
                    <div class="control-section">
                        <h3>👤 사람 모형 추가</h3>
                        <div class="control-group">
                            <label>사람 키 (cm)</label>
                            <input type="number" id="personHeight" value="170" min="50" max="250" step="1" placeholder="예: 170">
                        </div>
                        <button class="button" style="background: #9b59b6; color: white;" onclick="addPerson()">👤 사람 추가</button>
                        <button class="button button-secondary" onclick="clearAllPersons()">사람 전체 삭제</button>
                        <div class="info-item" style="margin-top: 10px; font-size: 12px;">
                            💡 사람 모형으로 실제 비율을 확인하세요
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>레이어 (액자 목록)</h3>
                        <div id="frameLayerList" class="layer-list"></div>
                    </div>

                    <div class="control-section">
                        <div class="grid-toggle">
                            <input type="checkbox" id="gridToggle" onchange="toggleGrid()">
                            <label for="gridToggle">그리드 표시 (50cm)</label>
                        </div>
                    </div>

                    <div class="info-panel">
                        <h3>📊 정보</h3>
                        <div class="info-item">액자 개수: <strong id="frameCount">0</strong></div>
                        <div class="info-item">벽 크기: <strong id="wallSize">400 × 300 cm</strong></div>
                    </div>
                </div>

                <div class="workspace">
                    <div id="wall" class="wall"></div>
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomWallEditor(-0.1)">−</button>
                        <span id="wallEditorZoomValue">100%</span>
                        <button class="zoom-btn" onclick="zoomWallEditor(0.1)">+</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 평면도 탭 -->
        <div id="floor-plan" class="tab-content">
            <div class="main-content">
                <div class="controls">
                    <div class="control-section">
                        <h3>공간 설정</h3>
                        <div class="control-group">
                            <label>공간 너비 (cm)</label>
                            <input type="number" id="spaceWidth" value="800" min="400" max="2000" step="10">
                        </div>
                        <div class="control-group">
                            <label>공간 높이 (cm)</label>
                            <input type="number" id="spaceHeight" value="600" min="400" max="2000" step="10">
                        </div>
                        <button class="button button-primary" onclick="updateFloorPlan()">공간 크기 적용</button>
                    </div>

                    <div class="control-section">
                        <h3>벽 추가</h3>
                        <div id="wallList"></div>
                    </div>

                    <div class="control-section">
                        <h3>저장/불러오기</h3>
                        <button class="button" style="background: #27ae60; color: white;" onclick="saveProject()">💾 프로젝트 저장</button>
                        <button class="button" style="background: #f39c12; color: white;" onclick="document.getElementById('projectFileInput').click()">📂 프로젝트 불러오기</button>
                        <input type="file" id="projectFileInput" accept=".json" style="display: none;" onchange="loadProject(event)">
                    </div>

                    <div class="info-panel">
                        <h3>💡 사용법</h3>
                        <div class="info-item">• 벽을 드래그하여 배치</div>
                        <div class="info-item">• 벽을 우클릭하여 메뉴 표시</div>
                        <div class="info-item">• 회전 핸들로 각도 조정</div>
                        <div class="info-item">• 스페이스바 + 드래그로 캔버스 이동</div>
                        <div class="info-item">• Alt + 마우스 휠로 확대/축소</div>
                    </div>
                </div>

                <div class="workspace">
                    <div id="floorPlanCanvas" class="floor-plan-canvas"></div>
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomFloorPlan(-0.1)">−</button>
                        <span id="floorPlanZoomValue">100%</span>
                        <button class="zoom-btn" onclick="zoomFloorPlan(0.1)">+</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 컨텍스트 메뉴 -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" onclick="editWall()">✏️ 벽 수정</div>
        <div class="context-menu-item" onclick="viewWallStructure()">👁️ 벽 구조 확인</div>
        <div class="context-menu-item context-menu-delete" onclick="deleteWallFromContext()">🗑️ 벽 삭제</div>
    </div>

    <!-- 벽 구조 확인 팝업 -->
    <div id="wallStructurePopup" class="popup-overlay">
        <div class="popup-container">
            <div class="popup-header">
                <h2 id="popupWallName">벽 구조</h2>
                <button class="popup-close" onclick="closeWallStructurePopup()">×</button>
            </div>
            <div class="popup-content">
                <div id="popupWall" class="popup-wall"></div>
            </div>
        </div>
    </div>

    <!-- 새 이미지 크롭 팝업 -->
    <div id="imageCropPopup" class="popup-overlay">
        <div class="popup-container">
            <div class="popup-header">
                <h2>액자 이미지 첨부 및 크롭</h2>
                <button class="popup-close" onclick="closeImageCropPopup()">×</button>
            </div>
            <div class="popup-content">
                <input type="file" id="popupImageInput" accept="image/*">
                <img id="cropImage" style="max-width: 100%; display: none;">
                <div class="crop-controls">
                    <button class="button button-primary" onclick="applyCroppedImage()">적용</button>
                    <button class="button button-secondary" onclick="closeImageCropPopup()">취소</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/core.js"></script>
    <script src="js/frames.js"></script>
    <script src="js/floorplan.js"></script>
</body>
</html>